<!DOCTYPE HTML>
<head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
	<script src="js/jquery-ui.js"></script>
	<script src = "https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.js"></script>
	<script src = "js/csvParser.js"></script>
	<script src = "js/brother.js"></script>
	<link rel = "stylesheet" type="text/css" href="css/index.css"></link>
	<link rel = "stylesheet" type = "text/css" href = "css/demographics.css"></link>
	<link rel = "stylesheet" type = "text/css" href = "css\font-awesome-4.6.3\css\font-awesome.css">
	<meta charset="UTF-8">
	<link rel="icon" type="image/ico" href="http://beta.org/wp-content/uploads/2013/10/Beta-Theta-Pi-Favicon.png">
	<title>University of Rochster Beta Theta Pi</title>
</head>
<body>
	<header>
		<table style="padding-top: 20px; margin-left: 10px; margin-right: 10px">
			<tr>
				<td><a href = "index.html"><img src = "img/Beta-Theta-Pi-Horizontal-Identity-sm.png"></td></a>
				<td class = "menu">
					<ul style="list-style-type: none; margin:auto">
						<li><a href = "about.html">About</a></li>
						<li><a href = "members.html">Members</a></li>
						<li><a href = "events.html">Events</a></li>
						<li><a href = "leadership.html">Leadership</a></li>
						<li><a href = "demographics.html">Demographics</a></li>
						<li><a href = "join.html">Join Beta</a></li>
						<li><a href = "gallery.html">Gallery</a></li>
					</ul>
				</td>
				<td><a href ="https://www.rochester.edu"><img src = "img/UR-header-logo.png" style="height: 64px; width: 300px; "></a></td>
			</tr>
		</table>
	</header>
	<div style = "height: 125px"></div>
	<div class = "main">
		<table class = "statsTable">
			<tr>
				<td id = "classSize" class = "text"></td>
				<td id = "chapterSize" class = "text"></td>
				<td id = "avgGPA" class = "text">3.31</td>
			</tr>
			<tr>
				<td id = "pledgeLable" class = "text"></td>
				<td class = "text">Active Brothers</td>
				<td class = "text">Average GPA</td>
			</tr>
		</table>
		<table class = "statsTable" style="padding-top: 50px">
			<tr>
				<td>Majors</td>
				<td>Home States &amp Countries</td>
			</tr>
			<tr>
				<td colspan="1" class = "paddedTd"><canvas id="majorChart" width="400" height="400"></canvas></td>
				<td colspan="1"><canvas id="stateChart" width="400" height="400"></canvas></td>
			</tr>
		</table>
		
	</div>
</body>
<footer>
	<table class = "footer-table">
		<tr>
			<td><p>BETA THETA PI</p></td>
			<td><p id = "presName"><br>Beta Theta Pi <br>Rochester Colony President <br> <a id = "presEmail">Contact Us</a></p></td>
			<td>
				<div class = 'social-container'>
					<a href = "https://www.facebook.com/Beta-Theta-Pi-University-of-Rochester-1582668235351626/"><i class = "fa fa-facebook fa-lg"></i></a>
				</div>
			</td>
		</tr>
	</table>
	<hr>
	<p class = "copyright">&copy 2017 University Of Rochester Colony - Beta Theta Pi</p>
	<script>
		var eagles = 0;
		var brothers = Array();
		var pledgeClass = "";
		var classes = Array();
		var majors = Array();
		var states = Array();
		var main = function()
		{
			var xhttp2 = new XMLHttpRequest();
			var xhttp2 = new XMLHttpRequest();
			xhttp2.onreadystatechange = function()
			{
				if(xhttp2.readyState == 4 && xhttp2.status == 200)
				{
					var parser = new DOMParser();
					var xmlDoc = parser.parseFromString(xhttp2.responseText,"text/xml");
					$('#presName').prepend(xmlDoc.getElementsByTagName("name")[0].childNodes[0].nodeValue);
					$("#presEmail").attr("href", xmlDoc.getElementsByTagName("email")[0].childNodes[0].nodeValue);
					pledgeClass = xmlDoc.getElementsByTagName("pledgeclass")[0].childNodes[0].nodeValue;
				}
			}
			xhttp2.open("get", "data/strings.xml");
			xhttp2.send();
			var xhttp = new XMLHttpRequest();
			xhttp.onreadystatechange = function()
			{
				if(xhttp.readyState == 4 && xhttp.status == 200 && xhttp2.readyState == 4 && xhttp2.status == 200)
				{
					var members = xhttp.responseText.split("\n");
					for(var i = 0; i < members.length; i++)
					{
						var parse = new parser();
						var traits = [];
						parse.evaluate(members[i],traits);
						if(traits[0] != "")
						{
							brothers.push(new Brother(traits[0],traits[1], traits[2], traits[3], traits[4], traits[5], traits[6], traits[7], traits[8], traits[9], traits[10], traits[11]));
						}
					}
					for(var i = 0; i < brothers.length-1; i++)
					{
						if(brothers[i].isEagle == "Yes")
						{
							eagles++;
						}
   						classes[brothers[i].pledgeClass] = 1 + (classes[brothers[i].pledgeClass] || 0);
   						states[brothers[i].hometown] = 1 + (states[brothers[i].hometown] || 0);
   						for(var j = 0; j < brothers[i].major.length; j++)
   						{
   							majors[(brothers[i].major[j]+"").trim()] = 1 + (majors[(brothers[i].major[j]+"").trim()] || 0);
   						}
					}
					$('#chapterSize').text(brothers.length);
					$('#pledgeLable').text("Brothers in " + pledgeClass);
					$('#eagleSize').text(eagles);
					$('#classSize').text(classes[pledgeClass]);

					var majorNames = Object.keys(majors);
					var majorData = Array();
					var colors = Array();

					var stateNames = Object.keys(states);
					var stateData = Array();
					for(var key in states)
					{
						stateData.push(states[key]);
					}
					for(var key in majors)
					{
						majorData.push(majors[key]);
						colors.push(getRandomColor());
					}
					//chart stuff
					var ctx = document.getElementById("majorChart").getContext('2d');
					var chart = new Chart(ctx, {
					    // The type of chart we want to create
					    type: 'pie',

					    // The data for our dataset
					    data: {
					        labels: majorNames,
					        datasets: [{
					            label: "Majors",
					            backgroundColor: colors,
					            borderColor: "rgb(255,255,255)",
					            data: majorData,
					        }]
					    },

					    // Configuration options go here
					    options: 
					    {
					    	segmentShowStroke: false,
					    	legend: 
					    	{
					    		display: false
					    	}
					    }
					});
					var ctx = document.getElementById("stateChart").getContext('2d');
					var chart = new Chart(ctx, {
					    // The type of chart we want to create
					    type: 'pie',

					    // The data for our dataset
					    data: {
					        labels: stateNames,
					        datasets: [{
					            label: "States",
					            backgroundColor: colors,
					            borderColor: "rgb(255,255,255)",
					            data: stateData,
					        }]
					    },

					    // Configuration options go here
					    options: 
					    {
					    	segmentShowStroke: false,
					    	legend: 
					    	{
					    		display: false
					    	}
					    }
					});
				}
			}
			xhttp.open("get", "data/members.csv", true);
			xhttp.send();
		}
		$(document).ready(main);

		function getRandomColor() {
  var letters = '0123456789ABCDEF';
  var color = '#';
  for (var i = 0; i < 6; i++) {
    color += letters[Math.floor(Math.random() * 16)];
  }
  return color;
}
	</script>
</footer>